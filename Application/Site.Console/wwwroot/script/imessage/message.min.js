
/**
 * 消息提示组件
 * 
 * 1.调用
 * 字符串类型参数： $.message('成功');
 * 对象型参数：$.message({});
 * 
 * 2.参数详解
 *  message:' 操作成功',    //提示信息
    time:'2000',           //显示时间（默认：2s）
    type:'success',        //显示类型，包括4种：success.error,info,warning
    showClose:false,       //显示关闭按钮（默认：否）
    autoClose:true,        //是否自动关闭（默认：是）
 * 
 * type:success,error,info,warning
 */

$.extend({
    message: function (options) {
        var defaults = {
            message: ' 操作成功',
            time: '2000',
            type: 'success',
            showClose: false,
            autoClose: true,
            onClose: function () { },
            location: 'tc'//lt:左上，tc:上剧中，rt:右上，lb:左下，bc:下居中,rb:右下，cc:居中
        };

        if (typeof options === 'string') {
            defaults.message = options;
        }
        if (typeof options === 'object') {
            defaults = $.extend({}, defaults, options);
        }
        //message模版
        var templateClose = defaults.showClose ? '<a class="c-message--close">×</a>' : '';
        var template = '<div class="c-message messageFadeInDown">' +
            '<div class="c-message--main">' +
            '<i class=" c-message--icon c-message--' + defaults.type + '"></i>' +
            templateClose +
            '<div class="c-message--tip">' + defaults.message + '</div>' +
            '</div>' +
            '</div>';
        var _this = this;
        var $body = $('body');
        var $message = $(template);
        var timer;
        var closeFn, removeFn;
        //关闭
        closeFn = function () {
            $message.addClass('messageFadeOutUp');
            $message.one('webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend', function () {
                removeFn();
            })
        };
        //移除
        removeFn = function () {
            $message.remove();
            defaults.onClose(defaults);
            clearTimeout(timer);
        };
        //移除所有
        $('.c-message').remove();
        $body.append($message);
        var top = "0px";
        var left = "0px";
        var right = "0px";
        var botttom = "0px";
        var winHeight = $(window).height();
        var winWidth = $(window).width();
        switch (defaults.location) {
            case 'lt':
                $message.css({
                    'top': top,
                    'left': left
                });
                break;
            case 'tc':
                left = (winWidth - $message.width()) / 2;
                left = ((left / winWidth - 0.05) * 100) + '%';
                $message.css({
                    'top': top,
                    'left': left
                });
                break;
            case 'rt':
                $message.css({
                    'top': top,
                    'right': right
                });
                break;
            case 'cc':
                left = (winWidth - $message.width()) / 2;
                left = ((left / winWidth - 0.05) * 100) + '%';
                top = (winHeight - $message.height()) / 2;
                top = ((top / winHeight - 0.1) * 100) + '%';
                $message.css({
                    'top': top,
                    'left': left
                });
                break;
            case 'lb':
                $message.css({
                    'bottom': botttom,
                    'left': left
                });
                break;
            case 'bc':
                left = (winWidth - $message.width()) / 2;
                left = ((left / winWidth - 0.05) * 100) + '%';
                $message.css({
                    'bottom': botttom,
                    'left': left
                });
                break;
            case 'rb':
                $message.css({
                    'bottom': botttom,
                    'right': right
                });
                break;

        }
        //去除动画类
        $message.one('webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend', function () {
            $message.removeClass('messageFadeInDown');
        });
        //点击关闭
        $body.on('click', '.c-message--close', function (e) {
            closeFn();
        });
        //自动关闭
        if (defaults.autoClose) {
            timer = setTimeout(function () {
                closeFn();
            }, defaults.time)
        }
    }
});